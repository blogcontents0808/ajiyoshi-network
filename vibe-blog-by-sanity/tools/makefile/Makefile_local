# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®Makefileè¨­å®š
# vibe-blog-by-sanityç”¨ã®è¨­å®š

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®å¤‰æ•°
APP_DIR = app
STUDIO_PORT = 3333

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰
define setup_command
	cd $(APP_DIR) && $(NPM_CMD) install
	@echo "$(GREEN)âœ“ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸ$(NC)"
	@echo "$(YELLOW)âš  Sanityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„:$(NC)"
	@echo "  1. sanity.config.tsã®projectIdã‚’æ›´æ–°"
	@echo "  2. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š"
	@echo "  3. make studio ã§Sanity Studioã‚’èµ·å‹•"
endef

# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒãƒ³ãƒ‰
define preview_command
	cd $(APP_DIR) && $(NPM_CMD) run build && $(NPM_CMD) run start
endef

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚³ãƒãƒ³ãƒ‰
define dev_command
	cd $(APP_DIR) && $(NPM_CMD) run dev -- --port $(DEV_PORT)
endef

# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰
define deploy_command
	cd $(APP_DIR) && $(NPM_CMD) run build
	@echo "$(GREEN)âœ“ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ãŸ$(NC)"
	@echo "$(YELLOW)âš  ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„:$(NC)"
	@echo "  - make deploy-vercel: Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤"
	@echo "  - make deploy-firebase: Firebaseã«ãƒ‡ãƒ—ãƒ­ã‚¤"
	@echo "  - make deploy-studio: Sanity Studioã‚’ãƒ‡ãƒ—ãƒ­ã‚¤"
endef

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰
define clean_command
	cd $(APP_DIR) && rm -rf .next node_modules dist
	@echo "$(GREEN)âœ“ ãƒ“ãƒ«ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ$(NC)"
endef

# ãƒ­ãƒ¼ã‚«ãƒ«å›ºæœ‰ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
build: ## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
	@echo "$(CYAN)â–¶ ãƒ“ãƒ«ãƒ‰ä¸­...$(NC)"
	cd $(APP_DIR) && $(NPM_CMD) run build
	@echo "$(GREEN)âœ“ ãƒ“ãƒ«ãƒ‰å®Œäº†$(NC)"

studio: ## Sanity Studioã‚’èµ·å‹•
	@echo "$(CYAN)â–¶ Sanity Studioã‚’èµ·å‹•ä¸­...$(NC)"
	@echo "$(CYAN)ğŸ“ URL: http://localhost:$(STUDIO_PORT)$(NC)"
	cd $(APP_DIR) && $(NPM_CMD) run studio

import-contents: ## vibe-blogã®contentsã‚’Sanityã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
	@echo "$(CYAN)â–¶ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...$(NC)"
	cd $(APP_DIR) && $(NPM_CMD) run import-contents
	@echo "$(GREEN)âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†$(NC)"

deploy-studio: ## Sanity Studioã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Sanity Studioã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...$(NC)"
	cd $(APP_DIR) && $(NPM_CMD) run studio:deploy
	@echo "$(GREEN)âœ“ Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"

deploy-vercel: ## Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...$(NC)"
	cd $(APP_DIR) && $(NPSX_CMD) vercel --prod
	@echo "$(GREEN)âœ“ Vercelãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"

deploy-firebase: ## Firebaseã«ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Firebaseã«ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...$(NC)"
	cd $(APP_DIR) && $(NPM_CMD) run build && $(NPSX_CMD) firebase deploy
	@echo "$(GREEN)âœ“ Firebaseãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"

deploy-app: ## Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...$(NC)"
	@$(call deploy_command)
	@echo "$(GREEN)âœ“ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"